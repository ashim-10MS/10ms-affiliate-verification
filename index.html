<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Affiliate Verification Portal</title>
  <style>
    :root{
      --red:#e11d2e;
      --bg1:#fff5f5;
      --bg2:#f1f5f9;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --line:#e2e8f0;
      --okbg:#ecfdf3;
      --ok:#15803d;
      --badbg:#fef2f2;
      --bad:#b91c1c;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Arial, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color:var(--text);
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      padding:16px;
    }
    .wrap{max-width:900px;margin:0 auto}
    .hero{
      background:var(--red);
      color:#fff;
      border-radius:18px;
      padding:16px 18px;
      display:flex;
      gap:14px;
      align-items:center;
      box-shadow: 0 12px 30px rgba(0,0,0,.08);
    }
    .logo{
      width:56px;height:56px;
      border-radius:14px;
      background:#fff;
      padding:8px;
      flex:0 0 auto;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .logo img{max-width:100%;max-height:100%}
    .hero h1{margin:0;font-size:20px}
    .hero p{margin:4px 0 0;font-size:13px;opacity:.92}

    .card{
      margin-top:16px;
      background:var(--card);
      border-radius:18px;
      box-shadow: 0 12px 30px rgba(0,0,0,.06);
      padding:18px;
      border:1px solid rgba(226,232,240,.7);
    }

    .bangla-note{
      margin:0 0 12px 0;
      line-height:1.7;
      color:var(--muted);
      font-size:14px;
    }
    .warn{
      margin:10px 0 14px 0;
      font-weight:800;
      color:#dc2626;
      font-size:14px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    label{display:block;font-weight:800;font-size:13px;margin:0 0 6px 0}
    input{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:1px solid var(--line);
      font-size:14px;
      outline:none;
      background:#fff;
    }
    input:focus{border-color:#94a3b8}
    .full{grid-column:1 / -1}

    .btn{
      margin-top:12px;
      width:100%;
      background:var(--red);
      color:#fff;
      border:none;
      border-radius:999px;
      padding:14px;
      font-size:15px;
      font-weight:800;
      cursor:pointer;
    }
    .btn:disabled{opacity:.65;cursor:not-allowed}

    .helper{
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
      line-height:1.5;
    }
    .helper b{color:var(--text)}
    .helper .hot{color:#dc2626;font-weight:900}

    .result{
      margin-top:16px;
      border-radius:14px;
      padding:14px;
      border:1px solid transparent;
      display:none;
    }
    .result.ok{background:var(--okbg);border-color:#22c55e}
    .result.bad{background:var(--badbg);border-color:#ef4444}
    .result .title{
      font-weight:900;
      margin:0 0 10px 0;
      font-size:15px;
    }

    /* Photo + info aligned side-by-side (desktop + mobile) */
    .profile{
      display:flex;
      gap:14px;
      align-items:flex-start;
    }
    .photo{
      width:110px;height:110px;border-radius:16px;
      border:1px solid var(--line);
      object-fit:cover;
      background:#fff;
      flex:0 0 auto;
      display:none; /* only show if image loads */
    }
    .info{
      flex:1;
      font-size:15px;
      line-height:1.7;
      color:#065f46;
    }
    .info .k{font-weight:900;color:#065f46}
    .info a{color:#2563eb;font-weight:800;text-decoration:underline}

    .helpbox{
      margin-top:14px;
      padding:14px;
      border-radius:14px;
      background:#f8fafc;
      border:1px solid #e5e7eb;
      font-size:13px;
      line-height:1.7;
    }
    .helpbox .t{font-weight:900;margin-bottom:6px}
    .helpbox .h{font-weight:900;margin-top:8px}

    @media (max-width: 680px){
      .grid{grid-template-columns:1fr}
      .hero h1{font-size:18px}
      .logo{width:50px;height:50px}
      .photo{width:96px;height:96px}
    }
  </style>
</head>
<body>
  <div class="wrap">

    <div class="hero">
      <div class="logo">
        <img src="https://i.imgur.com/TPLibYw.png" alt="10 Minute School Logo">
      </div>
      <div>
        <h1>Affiliate Verification Portal</h1>
        <p>Instantly verify whether someone is an official 10 Minute School affiliate.</p>
      </div>
    </div>

    <div class="card">
      <p class="bangla-note">
        গুরুত্বপূর্ণ নির্দেশনা: ১০ মিনিট স্কুল-এর পক্ষ থেকে কেউ যোগাযোগ করলে, কোনো ধরনের টাকা প্রদান,
        ব্যক্তিগত তথ্য শেয়ার বা ভর্তি সংক্রান্ত সিদ্ধান্ত নেওয়ার আগে অবশ্যই নিচের ভেরিফিকেশন সিস্টেম ব্যবহার করে
        তার অ্যাফিলিয়েট পরিচয় যাচাই করুন।
      </p>
      <p class="bangla-note">
        শুধুমাত্র এই সিস্টেমে “Verified / Official Affiliate” হিসেবে প্রদর্শিত ব্যক্তিরাই ১০ মিনিট স্কুল-এর অনুমোদিত অ্যাফিলিয়েট।
      </p>
      <div class="warn">সতর্কতা: ভেরিফিকেশন ছাড়া কোনো ব্যক্তির কাছে টাকা পাঠাবেন না বা ব্যক্তিগত তথ্য শেয়ার করবেন না।</div>

      <div class="grid">
        <div>
          <label>Affiliate Code (required)</label>
          <input id="code" placeholder="e.g. AFB144" autocomplete="off" />
        </div>
        <div>
          <label>Phone Number (required)</label>
          <input id="phone" placeholder="e.g. 01XXXXXXXXX" autocomplete="off" />
        </div>

        <div class="full">
          <button id="btn" class="btn">Verify Affiliate</button>
          <div class="helper">
            If you are still unsure or confused, please contact the <b>10 Minute School Affiliation Team Helpline:</b>
            <span class="hot">+880 1896-057968</span>
          </div>
        </div>
      </div>

      <div id="result" class="result"></div>

      <div class="helpbox">
        <div class="t">সহায়তা প্রয়োজন?</div>
        যদি কোনো অ্যাফিলিয়েট ভেরিফিকেশন সিস্টেমে খুঁজে না পাওয়া যায়, অথবা যাচাই সংক্রান্ত বিষয়ে আপনি নিশ্চিত না হন,
        তাহলে অনুগ্রহ করে সরাসরি ১০ মিনিট স্কুল-এর অ্যাফিলিয়েশন টিমের সঙ্গে যোগাযোগ করুন।
        <div class="h">হেল্পলাইন নম্বর: +880 1896-057968</div>
      </div>
    </div>

  </div>

  <script>
    // ===== CONFIG =====
    const API_URL = "https://script.google.com/macros/s/AKfycbwQjroX2FZOgdjYQDn5sE0GWw73_fH0wH6jaGq_TcJb_B2FXh6TQHoEGf_kkhTdJkiW/exec";

    // ===== ELEMENTS =====
    const codeEl = document.getElementById('code');
    const phoneEl = document.getElementById('phone');
    const btn = document.getElementById('btn');
    const result = document.getElementById('result');

    function normalizePhone(phone){
      return String(phone || '').replace(/\D/g,'');
    }

    function showError(msg){
      result.className = 'result bad';
      result.style.display = 'block';
      result.innerHTML = `<div class="title" style="color:#b91c1c">Verification Failed</div><div>${escapeHtml(msg)}</div>`;
    }

    function showSuccess(a){
      result.className = 'result ok';
      result.style.display = 'block';

      const fb = a.facebook ? String(a.facebook).trim() : '';
      const pic = a.picture ? String(a.picture).trim() : '';

      // We will render image only if it loads (no broken icon).
      result.innerHTML = `
        <div class="title" style="color:#15803d">✅ Official 10 Minute School Affiliate</div>
        <div class="profile">
          <img id="affPic" class="photo" alt="Affiliate photo">
          <div class="info">
            <div><span class="k">Name:</span> ${escapeHtml(a.name || '')}</div>
            <div><span class="k">Affiliate Code:</span> ${escapeHtml(a.affiliateCode || '')}</div>
            <div><span class="k">Phone:</span> ${escapeHtml(a.phone || '')}</div>
            <div><span class="k">Level:</span> ${escapeHtml(a.level || '')}</div>
            ${fb ? `<div><span class="k">Facebook Profile:</span> <a href="${escapeAttr(fb)}" target="_blank" rel="noopener">View Profile</a></div>` : ``}
          </div>
        </div>
      `;

      // Handle photo gracefully
      const img = document.getElementById('affPic');
      if (pic && img){
        img.onload = () => { img.style.display = 'block'; };
        img.onerror = () => { img.style.display = 'none'; };
        img.src = pic;
      }
    }

    function setLoading(isLoading){
      btn.disabled = isLoading;
      btn.textContent = isLoading ? 'Verifying...' : 'Verify Affiliate';
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, s => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[s]));
    }
    function escapeAttr(str){
      return String(str).replace(/"/g,'&quot;');
    }

    async function verify(){
      const code = String(codeEl.value || '').trim();
      const phone = normalizePhone(phoneEl.value || '');

      if (!code || !phone){
        showError('Both Affiliate Code and Phone Number are required.');
        return;
      }

      setLoading(true);
      result.style.display = 'none';

      try{
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify({ code, phone })
        });

        const data = await res.json();

        if (data && data.found && data.affiliate){
          showSuccess(data.affiliate);
        } else {
          showError((data && (data.error || data.message)) ? (data.error || data.message) : 'No matching affiliate found.');
        }
      }catch(err){
        showError('System error. Please try again later.');
        console.error(err);
      }finally{
        setLoading(false);
      }
    }

    btn.addEventListener('click', verify);

    // Optional: Enter key triggers verify
    [codeEl, phoneEl].forEach(el => el.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') verify();
    }));
  </script>
</body>
</html>
